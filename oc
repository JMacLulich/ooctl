#!/usr/bin/env bash

set -euo pipefail

SCRIPT_PATH="${BASH_SOURCE[0]}"

if command -v readlink >/dev/null 2>&1; then
  while [ -L "$SCRIPT_PATH" ]; do
    target="$(readlink "$SCRIPT_PATH")"
    if [[ "$target" = /* ]]; then
      SCRIPT_PATH="$target"
    else
      SCRIPT_PATH="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)/$target"
    fi
  done
fi

ROOT="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
VENV_BIN="$ROOT/.venv/bin"
LOCAL_OC="$VENV_BIN/oc"

if [[ -x "$LOCAL_OC" ]]; then
  exec "$LOCAL_OC" "$@"
fi

if command -v oc >/dev/null 2>&1; then
  exec oc "$@"
fi

cat <<'EOF'
oc command is not on PATH.

From this project, you can use:
  ./oc <command>

or run once:
  source ./.venv/bin/activate
EOF
exit 1
